package work;

import info.monitorenter.gui.chart.Chart2D;
import info.monitorenter.gui.chart.ITrace2D;
import info.monitorenter.gui.chart.traces.Trace2DSimple;

import java.awt.Color;
import java.awt.Container;
import java.awt.FlowLayout;
import java.awt.Graphics;
import java.awt.GridLayout;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.WindowEvent;
import java.io.BufferedReader;
import java.io.FileReader;
import java.io.IOException;
import java.util.Calendar;

import javax.swing.JButton;
import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.JTextField;

import Xpack.XButton;

@SuppressWarnings("serial")
public class Graph extends JPanel implements ActionListener, WorkbookListener {
	public int width, height;
	public JTextField textTable;
	public JButton butTable;
	public JLabel results;
	public JButton butMode;
	private Container container;
	private PaintArea paintArea;

	public Graph(String title) {
		super();

		// this.setTitle(title);

		this.width = 800;
		height = 600;

		this.container = this;

		container.setLayout(new FlowLayout());
		// container.setSize(300, 300);
		setLayout(null);

		// setDefaultCloseOperation(DISPOSE_ON_CLOSE);

		// initComps();

		this.setSize(this.width, height);

		setVisible(true);
		Chart2D chart = new Chart2D();
		chart.setSize(700, 500);
		chart.setLocation(20, 20);
		// Create an ITrace:
		ITrace2D trace = new Trace2DSimple();
		// Add the trace to the chart. This has to be done before adding points
		// (deadlock prevention):
		chart.addTrace(trace);
		trace.setZIndex(2);
		trace.setColor(Color.red);

		// Add all points, as it is static:
		String templ = "";
		try {
			BufferedReader in = new BufferedReader(new FileReader("input.txt"));
			String str;
			while ((str = in.readLine()) != null) {
				templ += str;
			}
			in.close();
		} catch (IOException e1) {
			System.err.println(e1.getMessage());
		}

		String inputs[] = templ.split(",");
		int k = 0;
		for (String string : inputs) {
			try {
				trace.addPoint(k, Integer.parseInt(string));
			} catch (NumberFormatException e) {
				System.out.println("number format" + string);
			}
			k += 1;
		}
		initComps();
		// container.add(chart);
		// setLocationRelativeTo(null);

	}

	public void paintComponent(Graphics g) {
		// g.drawLine(10, 10, 100, 100);

	}

	private void initComps() {

		paintArea = new PaintArea();

		paintArea.setLocation(10, 100);

		paintArea.setSize(800, 500);

		container.add(paintArea);

		butMode = new JButton("Change");

		butMode.setSize(100, 20);

		butMode.setLocation(400, 10);
		butMode.addActionListener(this);
		container.add(butMode);

		XButton button = new XButton(this, null, "Reload");
		button.addActionListener(new ActionListener() {

			@Override
			public void actionPerformed(ActionEvent e) {

				paintArea.load();
			}
		});
		button.setLocation(550, 10);
		JLabel label = new JLabel("Selected Date:");
		final JTextField text = new JTextField(20);
		// text.setLocation(20,20);
		JButton b = new JButton("popup");
		b.setLocation(300, 20);
		JPanel p = new JPanel();

		p.add(label);
		p.add(text);
		p.add(b);

		p.setLocation(10, 10);
		p.setSize(300, 20);
		p.setLayout(new GridLayout(1, 3));
		container.add(p);

		results = new JLabel("blblablb");

		int reqDays = (int) ((700 - paintArea.getLast()) / paintArea.getSpeed());
		Calendar cal = Calendar.getInstance();
		cal.add(Calendar.DATE, reqDays);
		java.text.SimpleDateFormat sdf = new java.text.SimpleDateFormat(
				"dd-MM-yyyy");
		String text2 = "Last day: " + sdf.format(cal.getTime());
		results.setText(text2);
		System.out.println(text2);
		results.setLocation(20, 40);
		results.setSize(200, 200);
		container.add(results);


		final JFrame fr = (JFrame) this.getParent();
		b.addActionListener(new ActionListener() {
			public void actionPerformed(ActionEvent ae) {
				DatePicker datePicker = new DatePicker(fr);
				text.setText(datePicker.setPickedDate());

				Calendar cal = Calendar.getInstance();

				int i = cal.get(Calendar.DAY_OF_YEAR);
				int fark = datePicker.getDayOfYear() - i;
				System.out.println(i);
				paintArea.payForDay(fark);

			}
		});
	}

	@Override
	public void actionPerformed(ActionEvent e) {
		if (e.getSource() == butMode) {
			String str = JOptionPane.showInputDialog(this, "input");
			paintArea.changeMode(Integer.parseInt(str));

		}
	}

	@Override
	public boolean exiting(WindowEvent e) {

		return true;
	}

}
